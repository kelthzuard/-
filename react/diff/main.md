# react diff 算法

在React应用中，当一个组件的状态发生变化后，会重新渲染整个组件子树。  
为了减少渲染成本，react使用的diff算法。  
react检测到改变调用render生成新的虚拟节点树后，对新节点和旧节点进行diff算法改变，并且递归对子节点进行diff。  
将要更新东西的加入差异化队列中。diff结束后遍历差异化队列进行修改。  

## 不同类型元素（标签不同）

直接卸载原来节点，新建一个节点并渲染。如果卸载的节点有子节点，也会全部卸载重新渲染。

## 相同类型元素

保留DOM，修改不同的属性（style，class，data）

## 相同类型的组件元素

调用组件更新的生命周期，并递归对其子组件进行patch。

## react和vue diff算法相同和不同

### 相同

1. 都是利用虚拟dom对比得出需要更改的部分。
2. 都是进行同层级比较。将事件复杂度降低到O(n)
3. 都可以用key简化diff操作。

### 不同

1. vue在对比子节点时用的头尾两个指针进行对比，效率更高。react只能顺序对比。
2. vue边对比边更新，react把差异结果加入patch树。最后一起更新。
3. vue由于响应式机制组件提前知道了哪些节点会收到数据更改的影响，react会把该节点和所有子节点进行diff。react并不清楚哪些节点具体发生了改变，会全部进行更新。而vue由于清楚了节点的更新范围。相当于进行了依次shouldComponentUpdate的优化。
4. 总的来说，vue效率更高。